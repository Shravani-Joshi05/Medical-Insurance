# -*- coding: utf-8 -*-
"""Untitled27.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/11tbze_CWbSV9qNd2Nk-CxpJnmY_YTK2i
"""

import streamlit as st
import pandas as pd
import pickle
import matplotlib.pyplot as plt

# ================= LOAD MODEL =================
with open("insurance_model.pkl", "rb") as file:
    model = pickle.load(file)

# ================= PAGE SETUP =================
st.set_page_config(
    page_title="AI Driven Medical Insurance Cost Prediction",
    layout="wide"
)

st.title("ü§ñ AI Driven Medical Insurance Cost Prediction")
st.write("This application predicts medical insurance charges using machine learning.")

# ================= LAYOUT =================
left_col, right_col = st.columns(2)

# ================= LEFT SIDE: INPUT =================
with left_col:
    st.subheader("üßæ Enter Customer Details")

    age = st.number_input("Age", 1, 100, 25)
    sex = st.selectbox("Sex", ["male", "female"])
    bmi = st.number_input("BMI", 10.0, 50.0, 22.0)
    children = st.number_input("Number of Children", 0, 5, 0)
    smoker = st.selectbox("Smoker", ["yes", "no"])
    region = st.selectbox(
        "Region",
        ["southwest", "southeast", "northwest", "northeast"]
    )

    predict_btn = st.button("üîç Predict Insurance Cost")

# ================= ENCODING (SAME AS TRAINING) =================
sex_val = 1 if sex == "male" else 0
smoker_val = 1 if smoker == "yes" else 0

region_map = {
    "southwest": 0,
    "southeast": 1,
    "northwest": 2,
    "northeast": 3
}
region_val = region_map[region]

# ================= RIGHT SIDE: OUTPUT =================
with right_col:
    st.subheader("üìä Prediction & Analysis")

    if predict_btn:
        input_df = pd.DataFrame([[
            age, sex_val, bmi, children, smoker_val, region_val
        ]], columns=["age", "sex", "bmi", "children", "smoker", "region"])

        # üî• Prevent feature-name error
        prediction = model.predict(input_df.values)[0]

        st.success(f"üí∞ Predicted Insurance Cost: ‚Çπ {prediction:,.2f}")

        # ================= GRAPH =================
        st.subheader("üìà BMI vs Predicted Insurance Cost")

        bmi_values = list(range(18, 41))
        cost_predictions = []

        for b in bmi_values:
            temp_df = pd.DataFrame([[
                age, sex_val, b, children, smoker_val, region_val
            ]])
            cost_predictions.append(model.predict(temp_df.values)[0])

        fig, ax = plt.subplots()
        ax.plot(bmi_values, cost_predictions)
        ax.set_xlabel("BMI")
        ax.set_ylabel("Predicted Insurance Cost")
        ax.set_title("Impact of BMI on Insurance Cost")

        st.pyplot(fig)

    else:
        st.info("üëà Enter details on the left and click **Predict Insurance Cost**")